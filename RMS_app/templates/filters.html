<style>
  :root {
    --background-light: #f6f7fb;
    --background-dark: linear-gradient(180deg, #141f34 0%, #101c2c 100%);
    --card-light: #fff;
    --card-dark: #141f34;
    --card-text-light: #233344;
    --card-text-dark: #d5d9e4;
    --card-border-light: #e4e8ef;
    --card-border-dark: #364665;
    --box-shadow-light: 0 2px 8px rgba(22, 36, 59, 0.03);
    --box-shadow-dark: 0 2px 8px rgba(10, 24, 48, 0.12);
    --filter-bg-light: #fff;
    --filter-bg-dark: #1e2a4a;
    --filter-text-light: #233344;
    --filter-text-dark: #d5d9e4;
  }
  body {
    background: var(--background-light);
    padding-top: 56px;
    transition: background 0.3s;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
      Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue",
      sans-serif;
  }
  body.dark-mode {
    background: var(--background-dark);
    color: var(--card-text-dark);
  }
  .filter-group.alarm-type,
  .filter-group.site-type,
  .filter-group.global-no,
  .filter-group.site-name,
  .filter-group.export,
  .filter-group.imei-no,
  .filter-group.enter_days,
  .filter-group.pdf,
  .filter-group.date-range {
    display: none !important;
  }

  main.dashboard-content {
    transition: margin-left 0.3s;
    background: var(--background-light);
  }
  body.dark-mode main.dashboard-content {
    background: var(--card-dark);
    color: var(--card-text-dark);
  }
  .sidebar:hover ~ main.dashboard-content {
    margin-left: 188px;
    width: calc(100vw - 260px);
  }

  .filter-bar {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    align-items: flex-start;
    background: var(--filter-bg-light);
    border-radius: 12px;
    padding: 16px 24px 64px 24px;
    gap: 24px;
    box-shadow: var(--box-shadow-light);
    border: 1px solid #2189e5ff;
    margin-bottom: 24px;
    position: relative;
    min-height: 130px;
    transition: background 0.3s, color 0.3s, border-color 0.3s;
  }
  body.dark-mode .filter-bar {
    background: var(--filter-bg-dark);
    border-color: #2189e5ff;
    box-shadow: var(--box-shadow-dark);
    color: var(--filter-text-dark);
  }

  .button-group {
    position: absolute;
    bottom: 16px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 16px;
  }
  .btn-search,
  .btn-reset {
    margin: 0;
    cursor: pointer;
    border: none;
    font-weight: 600;
    font-size: 1.05rem;
    border-radius: 8px;
    box-shadow: 0 4px 18px rgba(22, 36, 59, 0.12),
      0 2px 6px rgba(22, 36, 59, 0.08);
    background: inherit;
    position: relative;
    transition: transform 0.18s cubic-bezier(0.36, 1.43, 0.44, 1.01),
      box-shadow 0.18s cubic-bezier(0.36, 1.43, 0.44, 1.01);
    background-image: linear-gradient(
      120deg,
      rgba(0, 64, 255, 0.4) 0%,
      rgba(0, 208, 255, 0.2) 94%
    );
  }
  .btn-search:active,
  .btn-reset:active {
    transform: translateY(2px) scale(0.98);
    box-shadow: 0 2px 7px rgba(22, 36, 59, 0.09),
      0 1px 4px rgba(22, 36, 59, 0.08);
  }
  .btn-search:hover,
  .btn-reset:hover {
    box-shadow: 0 6px 24px rgba(160, 160, 160, 0.18),
      0 3px 8px rgba(204, 204, 204, 0.1);
    filter: brightness(1.06);
    outline: none;
  }
  .btn-search:focus,
  .btn-reset:focus {
    box-shadow: 0 0 0 2px #8b5cf6, 0 4px 18px rgba(22, 36, 59, 0.12);
  }

  .filter-group {
    display: flex;
    flex-direction: column;
    min-width: 180px;
    flex-grow: 1;
    max-width: 220px;
  }
  .filter-label {
    font-weight: 600;
    font-size: 0.95rem;
    margin-bottom: 4px;
    color: inherit;
  }

  .filter-select, .filter-input {
    border-radius: 8px;
    border: 1px solid var(--card-border-light);
    padding: 8px 12px;
    font-size: 1rem;
    color: var(--filter-text-light);
    background: var(--card-light);
    transition: background 0.3s, color 0.3s, border-color 0.3s;
  }
  body.dark-mode .filter-select, body.dark-mode .filter-input {
    background: var(--card-dark);
    border-color: var(--card-border-dark);
    color: var(--filter-text-dark);
  }
  .filter-select:focus, .filter-input:focus {
    outline: none;
    border-color: #8b5cf6;
    box-shadow: 0 0 0 2px #8b5cf6;
  }

  @media (max-width: 900px) {
    .filter-bar {
      flex-direction: column;
      gap: 16px;
      min-height: auto;
      padding-bottom: 80px;
    }
    main.dashboard-content {
      padding: 12px;
      width: 100vw;
      margin-left: 0;
    }
    body.dark-mode main.dashboard-content {
      width: 100vw;
    }
  }
  @media (max-width: 600px) {
    .button-group {
      flex-direction: column;
      bottom: 16px;
      gap: 12px;
      width: 100%;
      left: 0;
      transform: none;
      justify-content: center;
      align-items: center;
    }
  }
</style>

<main class="dashboard-content">
  <div class="filter-bar" role="region" aria-label="Filter Robotic Calls">

    <!-- State Filter -->
    <!-- State Filter -->
<div class="filter-group">
  <label for="filter-state" class="filter-label">State:</label>
  <select id="filter-state" class="filter-select" aria-controls="roboticCallsTable">
    <option value="">All</option>
    {% for state in state_data %}
      <option value="{{ state.state_id }}">{{ state.state_name }}</option>
    {% endfor %}
  </select>
</div>

<!-- District Filter -->
<div class="filter-group">
  <label for="filter-district" class="filter-label">District:</label>
  <select id="filter-district" class="filter-select" aria-controls="roboticCallsTable">
    <option value="">Select a state first</option>
  </select>
</div>

<!-- Cluster Filter -->
<div class="filter-group">
  <label for="filter-cluster" class="filter-label">Cluster:</label>
  <select id="filter-cluster" class="filter-select" aria-controls="roboticCallsTable">
    <option value="">Select a district first</option>
  </select>
</div>

    <!-- Site Type Filter -->
    <div class="filter-group">
      <label for="filter-site-type" class="filter-label">Site Type:</label>
      <select id="filter-site-type" class="filter-select" aria-controls="roboticCallsTable">
        <option value="">All</option>
        <option value="Type A">Type A</option>
        <option value="Type B">Type B</option>
        <option value="Type C">Type C</option>
      </select>
    </div>

    <!-- Site ID Filter -->
    <div class="filter-group">
      <label for="filter-site-id" class="filter-label">Site ID:</label>
      <input
        id="filter-site-id"
        class="filter-input"
        type="text"
        aria-controls="roboticCallsTable"
        placeholder="Enter Site ID..."
      />
    </div>

    <!-- IMEI Filter -->
    <div class="filter-group">
      <label for="filter-imei" class="filter-label">IMEI:</label>
      <input
        id="filter-imei"
        class="filter-input"
        type="text"
        aria-controls="roboticCallsTable"
        placeholder="Enter IMEI..."
      />
    </div>

        <!-- Call Status Filter -->
        <!--<div class="filter-group">-->
        <!--  <label for="filter-call-status" class="filter-label">Call Status:</label>-->
        <!--  <select id="filter-call-status" class="filter-select" aria-controls="roboticCallsTable">-->
        <!--    <option value="">All</option>-->
        <!--    <option value="SUCCESS">Success</option>-->
        <!--    <option value="FAILED">Failed</option>-->
        <!--    <option value="NO_ANSWER">No Answer</option>-->
        <!--    <option value="BUSY">Busy</option>-->
        <!--  </select>-->
        <!--</div>-->

    <!-- Date Range Filter -->
    <div class="filter-group">
      <label for="filter-date-from" class="filter-label">From Date:</label>
      <input id="filter-date-from" class="filter-input" type="date" aria-controls="roboticCallsTable" />
    </div>

    <div class="filter-group">
      <label for="filter-date-to" class="filter-label">To Date:</label>
      <input id="filter-date-to" class="filter-input" type="date" aria-controls="roboticCallsTable" />
    </div>

    <div class="button-group" role="group" aria-label="Search and reset filter actions">
      <button type="submit" class="filter-input btn-search">Search</button>
      <button type="reset" class="filter-input btn-reset">Reset</button>
    </div>
  </div>
</main>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const stateSelect = document.getElementById('filter-state');
    const districtSelect = document.getElementById('filter-district');
    const clusterSelect = document.getElementById('filter-cluster');
    const resetBtn = document.querySelector('.btn-reset');
    const searchBtn = document.querySelector('.btn-search');

    // Function to sort array of objects by name
    function sortByName(arr) {
        return arr.sort((a, b) => a.name.localeCompare(b.name));
    }

    // State → District filtering
    stateSelect.addEventListener('change', function() {
        const stateId = this.value;
        districtSelect.innerHTML = '<option value="">Loading...</option>';
        clusterSelect.innerHTML = '<option value="">Select a district first</option>';

        if (stateId) {
            fetch(`/get_districts_for_filter/${stateId}/`)
    .then(response => response.json())
    .then(data => {
        districtSelect.innerHTML = '<option value="">All</option>';
        const sortedDistricts = sortByName(data.districts);
        sortedDistricts.forEach(district => {
            const option = document.createElement('option');
            option.value = district.id;
            option.textContent = district.name;
            districtSelect.appendChild(option);
        });
    })

                .catch(error => {
                    console.error('Error fetching districts:', error);
                    districtSelect.innerHTML = '<option value="">Error loading districts</option>';
                });
        } else {
            districtSelect.innerHTML = '<option value="">Select a state first</option>';
            clusterSelect.innerHTML = '<option value="">Select a district first</option>';
        }
    });

    // District → Cluster filtering
    districtSelect.addEventListener('change', function() {
        const distId = this.value;
        clusterSelect.innerHTML = '<option value="">Loading...</option>';

        if (distId) {
            fetch(`/get_clusters_for_filter/${distId}/`)
    .then(response => response.json())
    .then(data => {
        clusterSelect.innerHTML = '<option value="">All</option>';
        const sortedClusters = sortByName(data.clusters);
        sortedClusters.forEach(cluster => {
            const option = document.createElement('option');
            option.value = cluster.id;
            option.textContent = cluster.name;
            clusterSelect.appendChild(option);
        });
    })

                .catch(error => {
                    console.error('Error fetching clusters:', error);
                    clusterSelect.innerHTML = '<option value="">Error loading clusters</option>';
                });
        } else {
            clusterSelect.innerHTML = '<option value="">Select a district first</option>';
        }
    });

    // Reset button functionality
    resetBtn.addEventListener('click', function(e) {
        e.preventDefault();

        // Reset all form elements
        const allInputs = document.querySelectorAll('.filter-input, .filter-select');
        allInputs.forEach(input => {
            if (input.type === 'date' || input.type === 'text') {
                input.value = '';
            } else if (input.tagName === 'SELECT') {
                input.selectedIndex = 0;
            }
        });

        // Reset dependent dropdowns
        districtSelect.innerHTML = '<option value="">Select a state first</option>';
        clusterSelect.innerHTML = '<option value="">Select a district first</option>';

        console.log('Filters reset');
    });

    // Search button functionality
    searchBtn.addEventListener('click', function(e) {
        e.preventDefault();
        
        // Collect all filter values
        const filters = {
            state: stateSelect.value,
            district: districtSelect.value,
            cluster: clusterSelect.value,
            site_type: document.getElementById('filter-site-type').value,
            site_id: document.getElementById('filter-site-id').value,
            imei: document.getElementById('filter-imei').value,
            call_status: document.getElementById('filter-call-status').value,
            date_from: document.getElementById('filter-date-from').value,
            date_to: document.getElementById('filter-date-to').value
        };

        console.log('Search filters:', filters);
        
        // Here you would typically make an API call to fetch filtered data
        // For example:
        // fetchRoboticCallData(filters);
    });

    // Function to fetch robotic call data (placeholder)
    function fetchRoboticCallData(filters) {
    const params = new URLSearchParams();
    Object.entries(filters).forEach(([key, value]) => {
        if (value) params.append(key, value);
    });

    fetch(`/robotic_call_status_api/?${params.toString()}`)
        .then(response => response.json())
        .then(data => {
            console.log('Robotic call data:', data);
            // TODO: update your table here
        })
        .catch(error => {
            console.error('Error fetching robotic call data:', error);
        });
}
});
</script>