{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Shroti Telecom Pvt. Ltd. Dashboard</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body {
        margin: 0;
        padding: 0;
        overflow-x: hidden;
      }

      /* Fixed header (top-bar) */
      .top-bar {
        background: #fff;
        color: #141f34;
        padding: 12px 24px;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 56px;
        z-index: 1050;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .navbar .search {
        flex: 1;
        display: flex;
        justify-content: center;
        margin: 0 48px;
      }
      .search-box {
        display: flex;
        align-items: center;
        width: 480px;
        border: 1px solid #e4e8ef;
        border-radius: 10px;
        background: #fbfbfd;
        padding: 0 16px;
        font-size: 1rem;
        height: 36px;
        transition: box-shadow 0.2s, background 0.3s, border-color 0.3s;
      }
      .search-box:focus-within {
        box-shadow: 0 0 0 2px #8b5cf6;
        border-color: #8b5cf6;
      }
      .search-box svg {
        width: 20px;
        height: 15px;
        fill: #9ac1e1;
        margin-right: 8px;
        transition: fill 0.3s;
        pointer-events: none;
      }
      .search-box input {
        border: none;
        background: transparent;
        outline: none;
        width: 100%;
        font-size: 1rem;
        color: #233344;
        transition: color 0.3s;
      }

      /* Updated actions to be inline horizontally */
      .actions {
        display: flex;
        align-items: center;
        gap: 16px;
        position: relative;
      }
      .toggle-btn,
      .profile {
        display: flex;
        align-items: center;
        flex-shrink: 0;
        margin: 0;
      }
      .toggle-btn {
        width: 44px;
        height: 36px;
        border-radius: 12px;
        background: #fbfbfd;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 1.5px solid #d2d8e7;
        cursor: pointer;
        position: relative;
        box-sizing: border-box;
        transition: border-color 0.2s, background 0.3s;
      }
      .toggle-btn:hover {
        border-color: #8b5cf6;
      }
      .toggle-btn svg {
        width: 24px;
        height: 24px;
        fill: #212c37;
        transition: fill 0.22s;
        pointer-events: none;
      }
      .toggle-btn.dark svg {
        fill: #8b5cf6;
      }
      .profile {
        gap: 9px;
        cursor: pointer;
        user-select: none;
        position: relative;
        background: #f6f7fb;
        border-radius: 11px;
        padding: 4px 16px 4px 6px;
        transition: box-shadow 0.12s, background 0.3s;
      }
      .profile.open {
        box-shadow: 0 2px 9px rgba(22, 36, 59, 0.07);
      }
      .avatar {
        width: 36px;
        height: 26px;
        background: linear-gradient(135deg, #3b82f6 0%, #6ee7b7 100%);
        border-radius: 30%;
        color: #fff;
        font-weight: 600;
        font-size: 1.06rem;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        transition: background 0.3s;
      }
      .username {
        font-size: 1rem;
        font-weight: 500;
        color: #233344;
        margin-right: 2px;
        transition: color 0.3s;
        white-space: nowrap;
      }
      .profile-caret {
        font-size: 1rem;
        color: #a6adc9;
        vertical-align: middle;
        transition: color 0.2s;
      }
      /* Dropdown styles */
      .dropdown-menu {
        position: absolute;
        top: 42px;
        right: 0;
        width: 80px;
        height: 40px;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 6px 32px rgba(45, 55, 80, 0.13);
        border: 1px solid #f0f2f8;
        z-index: 1150;
        display: none;
        flex-direction: column;
        padding: 8px 0;
        user-select: none;
        transition: background 0.3s, border-color 0.3s;
      }
      .profile.open .dropdown-menu {
        display: flex;
      }
      .dropdown-item {
        padding: 2px 20px;
        padding-bottom: 8px;
        color: #233344;
        font-size: 0.8rem;
        font-weight: 500;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: background 0.15s, color 0.3s;
      }
      .dropdown-item svg {
        width: 18px;
        height: 18px;
        fill: #293e60;
        flex-shrink: 0;
        transition: fill 0.3s;
      }
      .sidebar {
        position: fixed; /* Make sidebar fixed */
        left: 0;
        top: 56px; /* Below the top bar */
        width: 72px; /* Collapsed width */
        height: calc(100vh - 56px); /* Full height minus top bar */
        background: #fff;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        padding: 24px 0 0 0;
        box-sizing: border-box;
        transition: width 0.3s ease;
        overflow: hidden;
        z-index: 100;
      }
      /* Expand sidebar on hover */
      .sidebar:hover {
        width: 260px;
        box-shadow: 2px 0 12px rgba(0, 0, 0, 0.4);
        overflow: visible;
      }
      .sidebar-nav {
        display: flex;
        flex-direction: column;
        gap: 8px;
        padding: 0 8px 0 8px;
        overflow: visible;
      }
      .sidebar-nav a.nav-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 8px;
        border-radius: 10px;
        font-weight: 500;
        font-size: 1.06rem;
        color: #2b2f32ff;
        transition: background 0.2s, color 0.2s;
        cursor: pointer;
        white-space: nowrap;
        overflow: hidden;
        text-decoration: none;
      }
      .sidebar-nav a.nav-item svg {
        width: 21px;
        height: 21px;
        fill: #233344;
        flex-shrink: 0;
      }

      /* Hide text labels by default */
      .sidebar:not(:hover) .nav-item span {
        display: none;
      }
      /* Show text labels and padding on hover of sidebar */
      .sidebar:hover .nav-item span {
        display: inline;
      }
      /* Adjust padding on hover */
      .sidebar:not(:hover) .nav-item {
        justify-content: center;
        padding: 12px 0;
      }
      .sidebar:hover .nav-item {
        padding: 12px 16px;
      }
      /* Active gradient style for "Home" */
      .sidebar-nav a.nav-item.active {
        background: linear-gradient(90deg, #8b5cf6 0%, #3b82f6 100%);
        color: #fff;
      }
      .sidebar-nav a.nav-item.active svg {
        fill: #fff;
      }
      /* Secondary highlight style for "NOC Analytics" */
      .sidebar-nav a.nav-item.sec-active {
        background: #202d43;
        color: #dae7fd;
      }
      .sidebar-nav a.nav-item.sec-active svg {
        fill: #dae7fd;
      }
      .sidebar-footer {
        margin-top: 10rem;
        padding: 0 8px 30px 100px;
        text-align: center;
        color: #687991ff;
        font-size: 1rem;
        opacity: 0.77;
        white-space: nowrap;
        overflow: hidden;
      }
      /* Hide footer text by default */
      .sidebar:not(:hover) .sidebar-footer {
        text-align: center;
        font-size: 0;
        padding: 12px 0;
        overflow: visible;
      }
      /* Show footer text on hover */
      .sidebar:hover .sidebar-footer {
        font-size: 1rem;
        padding: 0 16px 30px 16px;
        white-space: normal;
      }
      .sidebar-footer .version {
        margin-bottom: 6px;
      }

      /* Dark mode styles for search box, toggle, and profile */
      .dark-mode .search-box {
        background-color: #2c3448;
        border: 1px solid #495571;
      }
      .dark-mode .search-box input {
        color: #d5d9e4;
      }
      .dark-mode .search-box svg circle,
      .dark-mode .search-box svg line {
        stroke: #9ac1e1;
      }

      .dark-mode .top-bar {
        background: #141f34;
        color: #fff;
      }

      .dark-mode .toggle-btn {
        background-color: #141f34;
        border: 1.5px solid #495571;
      }
      .dark-mode .toggle-btn svg {
        fill: #c7d0e3;
      }
      .dark-mode .toggle-btn.dark svg {
        fill: #8b5cf6;
      }

      .dark-mode .profile {
        background-color: #141f34;
        border: 1.5px solid #495571;
      }
      .dark-mode .profile .avatar {
        background: linear-gradient(135deg, #615edf 0%, #2bc1fe 100%);
        color: #f5f7fa;
      }
      .dark-mode .profile .username {
        color: #fff;
      }
      .dark-mode .profile .profile-caret {
        color: #fff;
      }

      .dark-mode .dropdown-menu {
        background-color: #141f34;
        border: 1px solid #364665;
      }
      .dark-mode .dropdown-item {
        color: #fff;
      }
      .dark-mode .dropdown-item:hover {
        background-color: #141f34;
        color: #fff;
      }
      .dark-mode .dropdown-item svg {
        fill: #fff;
      }

      /* Dark mode sidebar overrides */
      .dark-mode .sidebar {
        background: linear-gradient(180deg, #141f34 0%, #101c2c 100%);
        color: #fff;
        box-shadow: 2px 0 12px rgba(0, 0, 0, 0.7);
      }

      .dark-mode .sidebar-nav a.nav-item {
        color: #fff;
      }

      .dark-mode .sidebar-nav a.nav-item.active {
        background: linear-gradient(90deg, #615edf 0%, #2bc1fe 100%);
        color: #fff;
      }

      .dark-mode .sidebar-nav a.nav-item.active svg {
        fill: #fff;
      }

      .dark-mode .sidebar-nav a.nav-item svg {
        fill: #adc3f7;
      }
    </style>
  </head>
  <body>
    <div class="top-bar">
      <div>
        <img src="{% static 'logo-modified.png' %}" alt="STPL Logo" style="height:25px; border-radius:50%;">
        <strong style="font-size:20px;">STPL</strong>
      </div>
      <div class="search" role="search">
        <div class="search-box">
          <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <circle
              cx="11"
              cy="11"
              r="7"
              stroke="#9ac1e1"
              stroke-width="2"
              fill="none"
            />
            <line
              x1="17"
              y1="17"
              x2="21"
              y2="21"
              stroke="#9ac1e1"
              stroke-width="2"
            />
          </svg>
          <input
            type="text"
            placeholder="Search resources, reports, users..."
            aria-label="Search resources, reports, users"
          />
        </div>
      </div>
      <div class="actions">
        <div
          class="toggle-btn"
          id="themeToggle"
          title="Toggle Dark/Light Mode"
          role="button"
          tabindex="0"
          aria-label="Toggle Dark/Light mode"
          aria-pressed="false"
        >
          <svg
            id="toggleIcon"
            viewBox="0 0 24 24"
            aria-hidden="true"
            focusable="false"
          >
            <circle cx="12" cy="12" r="5" fill="none" />
            <g>
              <circle cx="12" cy="12" r="5" />
              <line x1="12" y1="2" x2="12" y2="4" />
              <line x1="12" y1="20" x2="12" y2="22" />
              <line x1="4.2" y1="4.2" x2="5.6" y2="5.6" />
              <line x1="18.4" y1="18.4" x2="19.8" y2="19.8" />
              <line x1="2" y1="12" x2="4" y2="12" />
              <line x1="20" y1="12" x2="22" y2="12" />
              <line x1="4.2" y1="19.8" x2="5.6" y2="18.4" />
              <line x1="18.4" y1="5.6" x2="19.8" y2="4.2" />
            </g>
          </svg>
        </div>
        <div
          class="profile"
          id="profileDropdownBtn"
          tabindex="0"
          aria-haspopup="true"
          aria-expanded="false"
          aria-label="User profile menu"
        >
          <span class="avatar" aria-hidden="true">SA</span>
          <span class="username">Super Admin</span>
          <span class="profile-caret">&#9662;</span>
          <div
            class="dropdown-menu"
            id="profileDropdownMenu"
            role="menu"
            aria-hidden="true"
          >
            <div
              class="dropdown-item"
              role="menuitem"
              tabindex="0"
              id="signOutBtn"
            >
              <svg viewBox="0 0 20 20" aria-hidden="true" focusable="false">
                <path
                  d="M5 4v2H3v8h2v2a1 1 0 0 0 1 1h5v-2H6v-2h7.59l-2.3-2.3 1.42-1.4 4 4a1 1 0 0 1 0 1.4l-4 4-1.42-1.4 2.3-2.3H6v2H5a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h1V2h5v2H6z"
                />
              </svg>
              Sign out
            </div>
          </div>
        </div>
      </div>
    </div>
<div class="{% block div_class %}{% endblock %}">
    <div class="d-flex">
      <div class="sidebar">
        <nav class="sidebar-nav">
          <a class="nav-item" href="/index">
            <svg viewBox="0 0 20 20">
              <rect x="3" y="8" width="6" height="9" />
              <rect x="11" y="3" width="6" height="14" />
            </svg>
            <span>Home</span>
          </a>
          <a class="nav-item" href="/analytics">
            <svg viewBox="0 0 20 20">
              <polyline
                points="3,15 7,11 13,17 17,13"
                stroke="#c2d2fa"
                stroke-width="2"
                fill="none"
              />
              <circle cx="3" cy="15" r="1" />
              <circle cx="7" cy="11" r="1" />
              <circle cx="13" cy="17" r="1" />
              <circle cx="17" cy="13" r="1" />
            </svg>
            <span>NOC Analytics</span>
          </a>
          <a class="nav-item" href="/energy">
            <svg viewBox="0 0 20 20">
              <polygon points="11,2 4,11 10,11 9,18 16,8 10,8" />
            </svg>
            <span>Energy</span>
          </a>
          <a class="nav-item" href="/battery">
            <svg viewBox="0 0 20 20">
              <rect x="4" y="6" width="12" height="8" rx="2" />
              <rect x="16" y="9" width="2" height="2" rx="1" />
            </svg>
            <span>Battery</span>
          </a>
          <a class="nav-item" href="/grid_billing">
            <svg viewBox="0 0 20 20">
              <rect x="4" y="5" width="12" height="10" rx="2" />
              <line
                x1="4"
                y1="10"
                x2="16"
                y2="10"
                stroke="#c2d2fa"
                stroke-width="2"
              />
            </svg>
            <span>Grid Billing</span>
          </a>
          <a class="nav-item" href="/maps">
            <svg viewBox="0 0 20 20">
              <circle cx="10" cy="8" r="3" />
              <path d="M10,11v6" />
              <path d="M6,17a4,4,0,0,1,8,0" />
            </svg>
            <span>Maps</span>
          </a>
          <a class="nav-item" href="/reports">
            <svg viewBox="0 0 20 20">
              <rect x="5" y="3" width="10" height="14" rx="2" />
              <line
                x1="8"
                y1="8"
                x2="12"
                y2="8"
                stroke="#c2d2fa"
                stroke-width="2"
              />
              <line
                x1="8"
                y1="12"
                x2="12"
                y2="12"
                stroke="#c2d2fa"
                stroke-width="2"
              />
            </svg>
            <span>Reports</span>
          </a>
          <a class="nav-item" href="/useradmin">
            <svg viewBox="0 0 20 20">
              <circle cx="10" cy="8" r="3" />
              <rect x="7" y="13" width="6" height="4" rx="2" />
            </svg>
            <span>Admin</span>
          </a>
        </nav>
        <div class="sidebar-footer">
          <div class="version">RMS v2.1.0</div>
          © 2024 Resource Management
        </div>
      </div>

      {% block body %}{% endblock body %}
    </div>
    <script>
      // Dark/Light toggle implementation
      const toggleBtn = document.getElementById("themeToggle");
      const toggleIcon = document.getElementById("toggleIcon");
      const sidebar = document.querySelector(".sidebar");
      let isDark = false;

      function updateToggleIcon(dark) {
        if (dark) {
          toggleIcon.innerHTML =
            '<path d="M21 12.79A9 9 0 0 1 12.21 3a7 7 0 1 0 8.79 9.79z"/>';
          toggleBtn.setAttribute("aria-pressed", "true");
        } else {
          toggleIcon.innerHTML = `<circle cx="12" cy="12" r="5" fill="none"/>
      <g>
        <circle cx="12" cy="12" r="5"/>
        <line x1="12" y1="2" x2="12" y2="4"/>
        <line x1="12" y1="20" x2="12" y2="22"/>
        <line x1="4.2" y1="4.2" x2="5.6" y2="5.6"/>
        <line x1="18.4" y1="18.4" x2="19.8" y2="19.8"/>
        <line x1="2" y1="12" x2="4" y2="12"/>
        <line x1="20" y1="12" x2="22" y2="12"/>
        <line x1="4.2" y1="19.8" x2="5.6" y2="18.4"/>
        <line x1="18.4" y1="5.6" x2="19.8" y2="4.2"/>
      </g>`;
          toggleBtn.setAttribute("aria-pressed", "false");
        }
      }

      // On page load, check saved theme preference in localStorage
      const savedTheme = localStorage.getItem("theme");
      if (savedTheme === "dark") {
        isDark = true;
      } else if (savedTheme === "light") {
        isDark = false;
      } else {
        // no saved preference, use system preference
        if (
          window.matchMedia &&
          window.matchMedia("(prefers-color-scheme: dark)").matches
        ) {
          isDark = true;
        }
      }

      // Apply the theme based on isDark value
      document.body.classList.toggle("dark-mode", isDark);
      toggleBtn.classList.toggle("dark", isDark);
      sidebar.classList.toggle("dark-mode", isDark);
      updateToggleIcon(isDark);

      toggleBtn.addEventListener("click", () => {
        isDark = !isDark;
        document.body.classList.toggle("dark-mode", isDark);
        toggleBtn.classList.toggle("dark", isDark);
        sidebar.classList.toggle("dark-mode", isDark);
        updateToggleIcon(isDark);
        // Save current theme state to localStorage
        localStorage.setItem("theme", isDark ? "dark" : "light");
      });

      // Accessibility for toggle keypress
      toggleBtn.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          toggleBtn.click();
        }
      });

      // Profile dropdown toggle
      const profileBtn = document.getElementById("profileDropdownBtn");
      const profileMenu = document.getElementById("profileDropdownMenu");
      profileBtn.addEventListener("click", () => {
        const expanded = profileBtn.getAttribute("aria-expanded") === "true";
        profileBtn.setAttribute("aria-expanded", !expanded);
        profileBtn.classList.toggle("open");
        profileMenu.setAttribute("aria-hidden", expanded);
      });
      // Close dropdown on click outside
      document.addEventListener("click", (e) => {
        if (!profileBtn.contains(e.target)) {
          profileBtn.classList.remove("open");
          profileBtn.setAttribute("aria-expanded", "false");
          profileMenu.setAttribute("aria-hidden", "true");
        }
      });

      // Sign out click handler
      const signOutBtn = document.getElementById("signOutBtn");
      signOutBtn.addEventListener("click", () => {
        alert("Signing out..."); // Replace with real sign-out functionality
      });
      signOutBtn.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          signOutBtn.click();
        }
      });

      // Sidebar nav active link logic based on path
      document.addEventListener("DOMContentLoaded", function () {
        const links = document.querySelectorAll(".sidebar-nav .nav-item");
        let currentPath = window.location.pathname;

        if (currentPath.length > 1 && currentPath.endsWith("/")) {
          currentPath = currentPath.slice(0, -1);
        }

        links.forEach((link) => {
          let linkPath = link.getAttribute("href");
          if (linkPath.length > 1 && linkPath.endsWith("/")) {
            linkPath = linkPath.slice(0, -1);
          }
          if (linkPath === currentPath) {
            link.classList.add("active");
          } else {
            link.classList.remove("active");
          }
          if (link.classList.contains("active")) {
            link.classList.remove("sec-active");
          } else {
            link.classList.add("sec-active");
          }
          link.classList.remove("sec-active");
        });
      });
    </script>
  </body>
</html>