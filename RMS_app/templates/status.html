{% extends "base.html" %} {% block div_class %}no-sidebar{% endblock %} {% block body %}

<style>
  /* ==========================================================
   === STYLING FOR SITE STATUS PAGE (MATCHING ALARMS THEME) ===
   ========================================================== */

  /* === Theme Variables (Light & Dark Mode) === */
  :root {
    --background-light: #eef3f7;
    --background-dark: #0f172a; /* Solid dark blue from alarms page */
    --card-light: #fff;
    --card-dark: #1e293b; /* Darker card color from alarms page */
    --card-text-light: #233344;
    --card-text-dark: #cbd5e1; /* Lighter text for dark mode */
    --card-border-light: #e4e8ef;
    --card-border-dark: #334155; /* Darker border */
    --shadow-light: 0 1px 3px rgba(0, 0, 0, 0.1);
    --shadow-dark: 2px 0 12px rgba(0, 0, 0, 0.4);
  }

  /* Hide sidebar when no-sidebar class present */
  div.no-sidebar .sidebar {
    display: none !important;
  }
  div.no-sidebar .main-content {
    margin-left: 0 !important;
    display: flex;
  }
  a {
    display: inline-flex;
    align-items: center;
    background-color: transparent;
    color: #141f34;
    margin-bottom: 1rem;
    border: none;
    font-size: 1rem;
    font-weight: 600;
    border-radius: 6px;
    text-decoration: none;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .dark-mode a {
    color: #fff;
  }
/* Base styles for collapsible sidebar */
.alarm-sidebar {
  position: fixed;
  left: 0;
  top: 56px;
  width: 72px;  /* collapsed width */
  height: calc(100vh - 56px);
  background: var(--card-light);
  color: var(--card-text-light);
  padding: 2rem 0 2rem 0;
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  transition: width 0.3s ease, background 0.2s, color 0.2s;
  overflow: hidden;
  box-shadow: var(--shadow-light);
  z-index: 100;
}
body.dark-mode .alarm-sidebar {
  background: var(--card-dark);
  color: var(--card-text-dark);
  box-shadow: var(--shadow-dark);
}

.alarm-sidebar:hover {
  width: 270px; /* expanded width */
  box-shadow: 2px 0 12px rgba(0, 0, 0, 0.4);
  overflow: visible;
}

/* Title styling */
.alarm-sidebar .sidebar-title {
  border-bottom: 1px solid #000000ff;
  margin-left: 0.4rem;
  margin-right: 0.4rem;
  font-size: 1.17rem;
  font-weight: 700;
  margin-bottom: 1.4rem;
  justify-content: center;
  display: flex;
  overflow: hidden;
  padding: 0 12px;
}

/* Navigation and KPI Entries as nav items */
.alarm-sidebar .sidebar-nav {
  display: flex;
  flex-direction: column;
  gap: 12px;
  padding: 0 12px;
  flex-grow: 1;
  overflow: visible;
}

.alarm-sidebar .nav-item {
  font-size: 1.09rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  cursor: pointer;
  padding: 0.5rem 1rem;
  border-radius: 6px;
  transition: background-color 0.2s ease;
  color: inherit;
  text-decoration: none;
  white-space: nowrap;
  overflow: hidden;
}

.alarm-sidebar .nav-item:hover {
  background-color: rgba(0, 123, 255, 0.1);
}

/* Hide label and value text when collapsed */
.alarm-sidebar:not(:hover) .nav-item span {
  display: none;
}
.alarm-sidebar .nav-item .kpi-icon {
  color: white;
  border-radius: 50%;
  width: 32px;
  height: 32px;
  text-align: center;
  font-size: 1.4rem;
  margin-right: 8px;
  display: inline !important;
}

.T {
  background-color: #3b82f6;
}
.A {
  background-color: #10b981;
}
.NA {
  background-color: #ef4444;
}


/* Show label and value on hover */
.alarm-sidebar:hover .nav-item span {
  display: inline;
}

/* Adjust padding and alignment when collapsed */
.alarm-sidebar:not(:hover) .nav-item {
  justify-content: center;
  padding-left: 0;
  padding-right: 0;
}

/* Active state styling */
.alarm-sidebar .nav-item.active {
  background: linear-gradient(90deg, #8b5cf6 0%, #3b82f6 100%);
  color: #fff;
}

/* Optionally add footer or other elements as needed */


  /* === Main Content & Body Styles === */
  .main-content {
    transition: margin-left 0.3s, width 0.3s;
  }

  body.dark-mode {
    background-color: var(--background-dark);
    color: var(--card-text-dark);
  }
  body.dark-mode h4,
  body.dark-mode .filter-label {
    color: #e2e8f0; /* Bright white for titles in dark mode */
  }

  /* === Filter Bar & Inputs (Alarms Theme) === */
  .filter-bar {
    background: var(--card-light);
    border: 1px solid var(--card-border-light);
    border-radius: 12px;
    padding: 1.5rem;
    display: flex;
    flex-wrap: wrap;
    gap: 1.5rem;
    margin-bottom: 2rem;
    box-shadow: var(--shadow-light);
  }
  body.dark-mode .filter-bar {
    background: var(--card-dark);
    border-color: var(--card-border-dark);
    box-shadow: var(--shadow-dark);
  }
  .filter-group {
    display: flex;
    flex-direction: column;
    min-width: 150px;
    flex: 1;
  }
  .filter-label {
    font-weight: 500;
    font-size: 0.875rem;
    margin-bottom: 0.5rem;
    color: #475569;
  }
  body.dark-mode .filter-label {
    color: #94a3b8;
  }
  .filter-select,
  .filter-input {
    background: #f1f5f9;
    color: var(--text-light);
    border: 1px solid #cbd5e1;
    border-radius: 8px;
    padding: 0.6rem 0.75rem;
    font-size: 1rem;
    width: 100%;
  }
  body.dark-mode .filter-select,
  body.dark-mode .filter-input {
    background: #334155;
    color: #f1f5f9;
    border: 1px solid #475569;
  }
  .filter-select:focus,
  .filter-input:focus {
    outline: 2px solid #3b82f6;
    border-color: transparent;
  }
  .search-button {
    background-color: #3b82f6;
    color: white;
    font-weight: 600;
    border: none;
    border-radius: 8px;
    padding: 0.6rem 1rem;
    cursor: pointer;
    height: 100%;
    transition: background-color 0.2s;
  }
  .search-button:hover {
    background-color: #2563eb;
  }

  /* === Table Styles (Alarms Theme) === */
  .results-table-wrapper {
    background: var(--card-light);
    border: 1px solid #2189e5ff;
    border-radius: 12px;
    padding: 0rem 0rem 1rem 0rem;
    overflow: hidden;
    box-shadow: var(--shadow-light);
  }
  body.dark-mode .results-table-wrapper {
    background: var(--card-dark);
    border-color: var(--card-border-dark);
    border: 1px solid #3395ecff;
    box-shadow: var(--shadow-dark);
  }
  .results-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
  }
  .results-table th,
  .results-table td {
    padding: 1rem 1.25rem;
    text-align: left;
    border-bottom: 1px solid #2189e5ff;
  }
  body.dark-mode .results-table th,
  body.dark-mode .results-table td {
    border-bottom: 1px solid #3395ecff;
  }
  .results-table thead th {
    font-weight: 700;
    font-size: 0.875rem;
    text-transform: uppercase;
    background-color: #2189e5ff;
    color: white;
  }
  body.dark-mode .results-table thead th {
    background-color: #3395ecff;
    color: white;
  }
  .results-table tbody tr:last-child td {
    border-bottom: none;
  }
  .results-table tbody tr {
    transition: background-color 0.2s;
  }
  .results-table tbody tr:hover {
    background-color: #f8fafc;
  }
  body.dark-mode .results-table tbody tr:hover {
    background-color: #28354a;
  }
  /* === NEW: PAGINATION STYLES === */
  .pagination-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem 0.5rem;
  }
  .pagination-info {
    font-size: 0.875rem;
    color: #64748b;
  }
  body.dark-mode .pagination-info {
    color: #94a3b8;
  }
  .pagination-links a,
  .pagination-links span {
    padding: 0.5rem 1rem;
    margin: 0 0.25rem;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    text-decoration: none;
    color: #334155;
    background-color: #fff;
    transition: background-color 0.2s;
  }
  body.dark-mode .pagination-links a,
  body.dark-mode .pagination-links span {
    border-color: #334155;
    color: #cbd5e1;
    background-color: #1e293b;
  }
  .pagination-links a:hover {
    background-color: #f1f5f9;
  }
  body.dark-mode .pagination-links a:hover {
    background-color: #334155;
  }
  .pagination-links .current-page {
    background-color: #3b82f6;
    color: white;
    border-color: #3b82f6;
  }
  .pagination-links .disabled {
    color: #9ca3af;
    background-color: #f3f4f6;
    cursor: not-allowed;
  }
  body.dark-mode .pagination-links .disabled {
    color: #4b5563;
    background-color: #374151;
  }

  /* === NEW: RESPONSIVE STYLES === */
  @media (max-width: 768px) {
    .main-content {
      padding: 1rem;
    }
    .filter-bar {
      flex-direction: column;
      gap: 1rem;
      padding: 1rem;
    }
    .results-table th,
    .results-table td {
      padding: 0.75rem;
    }
    .pagination-controls {
      flex-direction: column;
      gap: 1rem;
    }
  }
  .container-fluid {
    margin-left: 72px; /* same as sidebar width */
    padding: 24px; /* or use your desired padding */
    width: calc(100vw - 72px); /* fill remaining width */
    transition: margin-left 0.3s;
    min-height: calc(100vh - 56px);
    /* Overflow as needed */
  }
  .alarm-sidebar:hover ~ .container-fluid {
    margin-left: 260px;
    width: calc(100vw - 260px);
  }
</style>

<main class="main-content">
<div class=" alarm-sidebar">
  <div class="sidebar-title">Site Status</div>
  <nav class="sidebar-nav">
    <a class="nav-item" href="#" data-severity="all">
      <span class="kpi-icon T">T</span>
      <span class="kpi-label">Total</span>
      <span class="kpi-value" id="totalAlarmsCount">0</span>
    </a>
    <a class="nav-item" href="#" data-severity="all">
      <span class="kpi-icon A">A</span>
      <span class="kpi-label">Active</span>
      <span class="kpi-value" id="activeAlarmsCount">0</span>
    </a>
    <a class="nav-item" href="#" data-severity="all">
      <span class="kpi-icon NA">NA</span>
      <span class="kpi-label">Non Active</span>
      <span class="kpi-value" id="nonActiveAlarmsCount">0</span>
    </a>
  </nav>
</div>


  <div class="container-fluid">
    <!--<h4 class="mb-4">Site Status Search</h4>-->

    <!--<form action="{% url 'status' %}" method="get" class="filter-bar">-->
    <!--     <div class="row w-100 g-3">-->
    <!--        <div class="col-12 col-sm-6 col-lg-2">-->
    <!--            <div class="filter-group">-->
    <!--                <label for="zone" class="filter-label">Zone</label>-->
    <!--                <select class="filter-select" name="zone" id="zone">-->
    <!--                    <option value="">All</option>-->
    <!--                    {% for z in zones %}<option value="{{ z.zone }}" {% if z.zone == current_zone %}selected{% endif %}>{{ z.zone }}</option>{% endfor %}-->
    <!--                </select>-->
    <!--            </div>-->
    <!--        </div>-->
    <!--        <div class="col-12 col-sm-6 col-lg-2">-->
    <!--            <div class="filter-group">-->
    <!--                <label for="cluster" class="filter-label">Cluster</label>-->
    <!--                <select class="filter-select" name="cluster" id="cluster">-->
    <!--                    <option value="">All</option>-->
    <!--                    {% for c in clusters %}<option value="{{ c.cluster }}" {% if c.cluster == current_cluster %}selected{% endif %}>{{ c.cluster }}</option>{% endfor %}-->
    <!--                </select>-->
    <!--            </div>-->
    <!--        </div>-->
    <!--        <div class="col-12 col-sm-6 col-lg-2">-->
    <!--            <div class="filter-group">-->
    <!--                <label for="site_name" class="filter-label">Site Name</label>-->
    <!--                <input type="text" class="filter-input" name="site_name" id="site_name" value="{{ site_name }}" placeholder="Enter Site Name">-->
    <!--            </div>-->
    <!--        </div>-->
    <!--        <div class="col-12 col-sm-6 col-lg-2">-->
    <!--            <div class="filter-group">-->
    <!--                <label for="imei" class="filter-label">IMEI No</label>-->
    <!--                <input type="text" class="filter-input" name="imei" id="imei" value="{{ imei }}" placeholder="Enter IMEI">-->
    <!--            </div>-->
    <!--        </div>-->
    <!--        <div class="col-12 col-sm-6 col-lg-2">-->
    <!--            <div class="filter-group">-->
    <!--                <label for="global_no" class="filter-label">Global No</label>-->
    <!--                <input type="text" class="filter-input" name="global_no" id="global_no" value="{{ global_no }}" placeholder="Enter Global No">-->
    <!--            </div>-->
    <!--        </div>-->
    <!--        <div class="col-12 col-sm-6 col-lg-2 d-flex align-items-end">-->
    <!--            <button type="submit" class="search-button w-100">Search</button>-->
    <!--        </div>-->
    <!--    </div>-->
    <!--</form>-->

    <a href="/index">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="18"
        height="18"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 18 18"
        style="vertical-align: middle; margin-right: 7px"
      >
        <path
          d="M12 15l-6-6 6-6"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
      Back
    </a>

    {% include "filters.html" %}

    <div class="results-table-wrapper">
      <div class="table-responsive">
        <table class="results-table">
          <thead>
            <tr>
              <th>Site ID</th>
              <th>Site Name</th>
              <th>Global ID</th>
              <th>Battery (V)</th>
              <th>Signal (dBm)</th>
              <th>Last Communication</th>
              <th>Aging</th>
              <th>Active Alarms</th>
            </tr>
          </thead>
          <tbody>
            {% for item in page_obj %}
            <tr>
              <td>{{ item.site_id }}</td>
              <td>{{ item.site_name }}</td>
              <td>{{ item.global_id }}</td>
              {% if item.status_data %}
              <td>{{ item.status_data.volt }}</td>
              <td>{{ item.status_data.sig }}</td>
              <td>{{ item.status_data.update_at|date:"Y-m-d H:i" }}</td>
              {% else %}
              <td colspan="3" class="text-center text-muted">
                No Live Status Data
              </td>
              {% endif %}
              <td>-</td>
              <td>-</td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="8" class="text-center p-5">No results found.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      {% if page_obj.has_other_pages %}
      <div class="pagination-controls">
        <div class="pagination-info">
          Showing page {{ page_obj.number }} of {{ page_obj.paginator.num_pages
          }}
        </div>
        <div class="pagination-links">
          {% if page_obj.has_previous %}
          <a
            href="?page=1&site_name={{site_name}}&global_no={{global_no}}&imei={{imei}}&zone={{current_zone}}&cluster={{current_cluster}}"
            >&laquo; First</a
          >
          <a
            href="?page={{ page_obj.previous_page_number }}&site_name={{site_name}}&global_no={{global_no}}&imei={{imei}}&zone={{current_zone}}&cluster={{current_cluster}}"
            >Previous</a
          >
          {% else %}
          <span class="disabled">&laquo; First</span>
          <span class="disabled">Previous</span>
          {% endif %}

          <span class="current-page">{{ page_obj.number }}</span>

          {% if page_obj.has_next %}
          <a
            href="?page={{ page_obj.next_page_number }}&site_name={{site_name}}&global_no={{global_no}}&imei={{imei}}&zone={{current_zone}}&cluster={{current_cluster}}"
            >Next</a
          >
          <a
            href="?page={{ page_obj.paginator.num_pages }}&site_name={{site_name}}&global_no={{global_no}}&imei={{imei}}&zone={{current_zone}}&cluster={{current_cluster}}"
            >Last &raquo;</a
          >
          {% else %}
          <span class="disabled">Next</span>
          <span class="disabled">Last &raquo;</span>
          {% endif %}
        </div>
      </div>
      {% endif %}
    </div>
  </div>
</main>

{% endblock body %}
